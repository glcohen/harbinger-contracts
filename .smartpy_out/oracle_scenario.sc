[{"shortname": "Update_Once_With_Valid_Data", "longname": "Update Once With Valid Data", "scenario": [{"action": "html", "tag": "h1", "inner": "Update Once With Valid Data", "line_no": 137}, {"action": "html", "tag": "h2", "inner": "GIVEN an Oracle contract", "line_no": 139}, {"action": "newContract", "id": 0, "export": "(storage (record 58 (oracleData (type_annotation (big_map 47 ((literal (string \"XTZ-USD\") 143) (tuple (literal (timestamp 0) 49) (tuple (literal (timestamp 0) 49) (tuple (literal (intOrNat 0) 143) (tuple (literal (intOrNat 0) 143) (tuple (literal (intOrNat 0) 143) (tuple (literal (intOrNat 0) 143) (literal (intOrNat 0) 143) 143) 143) 143) 143) 143) 143))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 47)) (publicKey (variant \"Some\" (reduce (attr (account_of_seed \"Test1\" 1082) \"public_key\" 1082) 1082) 1083)))\nstorage_type (())\nmessages ((push True ((set (operations 128) (cons (transfer (attr (data) \"oracleData\" 128) (literal (mutez 0) 128) (params 127) 128) (operations 128) 128) 128))) (revoke True ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (params 111) (pack (type_annotation (variant \"None\" (unit) -1) (option \"key\") 113) 114) 118) False 118) (set (attr (data) \"publicKey\" 117) (variant \"None\" (unit) -1) 121))) (update True ((forGroup \"assetData\" (items (params 73) 75) ((defineLocal \"compute_79\" (first (attr (iter \"assetData\" 76) \"value\" 79) 79) 79) (defineLocal \"compute_80\" (second (attr (iter \"assetData\" 76) \"value\" 79) 80) 80) (ifBlock (contains (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 83) ((defineLocal \"compute_85\" (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 85) 85) (defineLocal \"compute_86\" (first (getLocal \"compute_85\" 85) 86) 86) (defineLocal \"compute_87\" (first (getLocal \"compute_80\" 80) 87) 87) (ifBlock (gt (getLocal \"compute_87\" 87) (getLocal \"compute_86\" 86) 88) ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (getLocal \"compute_79\" 79) (pack (tuple (attr (iter \"assetData\" 76) \"key\" 78) (getLocal \"compute_80\" 80) 90) 90) 92) \"bad sig\" 91) (set (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 99) (getLocal \"compute_80\" 80) 99)) 88)) 83)) 76))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 143, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "AND an update", "line_no": 145}, {"action": "html", "tag": "h2", "inner": "WHEN the oracle is updated", "line_no": 168}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 170 ((literal (string \"XTZ-USD\") 177) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 161) (tuple (literal (timestamp 1) 147) (tuple (literal (timestamp 2) 148) (tuple (literal (intOrNat 3) 161) (tuple (literal (intOrNat 4) 161) (tuple (literal (intOrNat 5) 161) (tuple (literal (intOrNat 6) 161) (literal (intOrNat 7) 161) 161) 161) 161) 161) 161) 161) 161) 161) \"Raw\" 162) 162) (tuple (literal (timestamp 1) 147) (tuple (literal (timestamp 2) 148) (tuple (literal (intOrNat 3) 177) (tuple (literal (intOrNat 4) 177) (tuple (literal (intOrNat 5) 177) (tuple (literal (intOrNat 6) 177) (literal (intOrNat 7) 177) 177) 177) 177) 177) 177) 177) 169))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 170)", "line_no": 177, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "THEN the oracle contains the data points", "line_no": 179}, {"action": "verify", "condition": "(eq (literal (timestamp 1) 147) (first (getItem (attr (contractData 0 177) \"oracleData\" 180) (literal (string \"XTZ-USD\") 180) 180) 187) 195)", "line_no": 195}, {"action": "verify", "condition": "(eq (literal (timestamp 2) 148) (first (second (getItem (attr (contractData 0 177) \"oracleData\" 180) (literal (string \"XTZ-USD\") 180) 180) 181) 188) 196)", "line_no": 196}, {"action": "verify", "condition": "(eq (first (second (second (getItem (attr (contractData 0 177) \"oracleData\" 180) (literal (string \"XTZ-USD\") 180) 180) 181) 182) 189) (literal (intOrNat 3) 197) 197)", "line_no": 197}, {"action": "verify", "condition": "(eq (first (second (second (second (getItem (attr (contractData 0 177) \"oracleData\" 180) (literal (string \"XTZ-USD\") 180) 180) 181) 182) 183) 190) (literal (intOrNat 4) 198) 198)", "line_no": 198}, {"action": "verify", "condition": "(eq (first (second (second (second (second (getItem (attr (contractData 0 177) \"oracleData\" 180) (literal (string \"XTZ-USD\") 180) 180) 181) 182) 183) 184) 191) (literal (intOrNat 5) 199) 199)", "line_no": 199}, {"action": "verify", "condition": "(eq (first (second (second (second (second (second (getItem (attr (contractData 0 177) \"oracleData\" 180) (literal (string \"XTZ-USD\") 180) 180) 181) 182) 183) 184) 185) 192) (literal (intOrNat 6) 200) 200)", "line_no": 200}, {"action": "verify", "condition": "(eq (second (second (second (second (second (second (getItem (attr (contractData 0 177) \"oracleData\" 180) (literal (string \"XTZ-USD\") 180) 180) 181) 182) 183) 184) 185) 193) (literal (intOrNat 7) 201) 201)", "line_no": 201}]}, {"shortname": "Second_Update_Overwrites_First_Update", "longname": "Second Update Overwrites First Update", "scenario": [{"action": "html", "tag": "h1", "inner": "Second Update Overwrites First Update", "line_no": 271}, {"action": "html", "tag": "h2", "inner": "GIVEN an Oracle contract", "line_no": 273}, {"action": "newContract", "id": 0, "export": "(storage (record 58 (oracleData (type_annotation (big_map 277 ((literal (string \"XTZ-USD\") 285) (tuple (literal (timestamp 0) 1088) (tuple (literal (timestamp 0) 1090) (tuple (literal (intOrNat 0) 285) (tuple (literal (intOrNat 0) 285) (tuple (literal (intOrNat 0) 285) (tuple (literal (intOrNat 0) 285) (literal (intOrNat 0) 285) 285) 285) 285) 285) 285) 285))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 277)) (publicKey (variant \"Some\" (reduce (attr (account_of_seed \"Test1\" 1082) \"public_key\" 1082) 1082) 1083)))\nstorage_type (())\nmessages ((push True ((set (operations 128) (cons (transfer (attr (data) \"oracleData\" 128) (literal (mutez 0) 128) (params 127) 128) (operations 128) 128) 128))) (revoke True ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (params 111) (pack (type_annotation (variant \"None\" (unit) -1) (option \"key\") 113) 114) 118) False 118) (set (attr (data) \"publicKey\" 117) (variant \"None\" (unit) -1) 121))) (update True ((forGroup \"assetData\" (items (params 73) 75) ((defineLocal \"compute_79\" (first (attr (iter \"assetData\" 76) \"value\" 79) 79) 79) (defineLocal \"compute_80\" (second (attr (iter \"assetData\" 76) \"value\" 79) 80) 80) (ifBlock (contains (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 83) ((defineLocal \"compute_85\" (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 85) 85) (defineLocal \"compute_86\" (first (getLocal \"compute_85\" 85) 86) 86) (defineLocal \"compute_87\" (first (getLocal \"compute_80\" 80) 87) 87) (ifBlock (gt (getLocal \"compute_87\" 87) (getLocal \"compute_86\" 86) 88) ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (getLocal \"compute_79\" 79) (pack (tuple (attr (iter \"assetData\" 76) \"key\" 78) (getLocal \"compute_80\" 80) 90) 90) 92) \"bad sig\" 91) (set (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 99) (getLocal \"compute_80\" 80) 99)) 88)) 83)) 76))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 285, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "AND two updates", "line_no": 287}, {"action": "html", "tag": "h2", "inner": "WHEN the oracle is updated", "line_no": 330}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 333 ((literal (string \"XTZ-USD\") 347) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 302) (tuple (literal (timestamp 1) 288) (tuple (literal (timestamp 2) 289) (tuple (literal (intOrNat 3) 302) (tuple (literal (intOrNat 4) 302) (tuple (literal (intOrNat 5) 302) (tuple (literal (intOrNat 6) 302) (literal (intOrNat 7) 302) 302) 302) 302) 302) 302) 302) 302) 302) \"Raw\" 303) 303) (tuple (literal (timestamp 1) 288) (tuple (literal (timestamp 2) 289) (tuple (literal (intOrNat 3) 347) (tuple (literal (intOrNat 4) 347) (tuple (literal (intOrNat 5) 347) (tuple (literal (intOrNat 6) 347) (literal (intOrNat 7) 347) 347) 347) 347) 347) 347) 347) 331))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 333)", "line_no": 347, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 340 ((literal (string \"XTZ-USD\") 348) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 323) (tuple (literal (timestamp 8) 309) (tuple (literal (timestamp 9) 310) (tuple (literal (intOrNat 10) 323) (tuple (literal (intOrNat 11) 323) (tuple (literal (intOrNat 12) 323) (tuple (literal (intOrNat 13) 323) (literal (intOrNat 14) 323) 323) 323) 323) 323) 323) 323) 323) 323) \"Raw\" 324) 324) (tuple (literal (timestamp 8) 309) (tuple (literal (timestamp 9) 310) (tuple (literal (intOrNat 10) 348) (tuple (literal (intOrNat 11) 348) (tuple (literal (intOrNat 12) 348) (tuple (literal (intOrNat 13) 348) (literal (intOrNat 14) 348) 348) 348) 348) 348) 348) 348) 332))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 340)", "line_no": 348, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "THEN the oracle contains the data points of the latter update", "line_no": 350}, {"action": "verify", "condition": "(eq (first (getItem (attr (contractData 0 348) \"oracleData\" 351) (literal (string \"XTZ-USD\") 351) 351) 358) (literal (timestamp 8) 309) 366)", "line_no": 366}, {"action": "verify", "condition": "(eq (first (second (getItem (attr (contractData 0 348) \"oracleData\" 351) (literal (string \"XTZ-USD\") 351) 351) 352) 359) (literal (timestamp 9) 310) 367)", "line_no": 367}, {"action": "verify", "condition": "(eq (first (second (second (getItem (attr (contractData 0 348) \"oracleData\" 351) (literal (string \"XTZ-USD\") 351) 351) 352) 353) 360) (literal (intOrNat 10) 368) 368)", "line_no": 368}, {"action": "verify", "condition": "(eq (first (second (second (second (getItem (attr (contractData 0 348) \"oracleData\" 351) (literal (string \"XTZ-USD\") 351) 351) 352) 353) 354) 361) (literal (intOrNat 11) 369) 369)", "line_no": 369}, {"action": "verify", "condition": "(eq (first (second (second (second (second (getItem (attr (contractData 0 348) \"oracleData\" 351) (literal (string \"XTZ-USD\") 351) 351) 352) 353) 354) 355) 362) (literal (intOrNat 12) 370) 370)", "line_no": 370}, {"action": "verify", "condition": "(eq (first (second (second (second (second (second (getItem (attr (contractData 0 348) \"oracleData\" 351) (literal (string \"XTZ-USD\") 351) 351) 352) 353) 354) 355) 356) 363) (literal (intOrNat 13) 371) 371)", "line_no": 371}, {"action": "verify", "condition": "(eq (second (second (second (second (second (second (getItem (attr (contractData 0 348) \"oracleData\" 351) (literal (string \"XTZ-USD\") 351) 351) 352) 353) 354) 355) 356) 364) (literal (intOrNat 14) 372) 372)", "line_no": 372}]}, {"shortname": "Update_Fails_With_Data_From_The_Same_Timestamp", "longname": "Update Fails With Data From The Same Timestamp", "scenario": [{"action": "html", "tag": "h1", "inner": "Update Fails With Data From The Same Timestamp", "line_no": 378}, {"action": "html", "tag": "h2", "inner": "GIVEN an Oracle contract", "line_no": 380}, {"action": "newContract", "id": 0, "export": "(storage (record 58 (oracleData (type_annotation (big_map 384 ((literal (string \"XTZ-USD\") 392) (tuple (literal (timestamp 0) 1088) (tuple (literal (timestamp 0) 1090) (tuple (literal (intOrNat 0) 392) (tuple (literal (intOrNat 0) 392) (tuple (literal (intOrNat 0) 392) (tuple (literal (intOrNat 0) 392) (literal (intOrNat 0) 392) 392) 392) 392) 392) 392) 392))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 384)) (publicKey (variant \"Some\" (reduce (attr (account_of_seed \"Test1\" 1082) \"public_key\" 1082) 1082) 1083)))\nstorage_type (())\nmessages ((push True ((set (operations 128) (cons (transfer (attr (data) \"oracleData\" 128) (literal (mutez 0) 128) (params 127) 128) (operations 128) 128) 128))) (revoke True ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (params 111) (pack (type_annotation (variant \"None\" (unit) -1) (option \"key\") 113) 114) 118) False 118) (set (attr (data) \"publicKey\" 117) (variant \"None\" (unit) -1) 121))) (update True ((forGroup \"assetData\" (items (params 73) 75) ((defineLocal \"compute_79\" (first (attr (iter \"assetData\" 76) \"value\" 79) 79) 79) (defineLocal \"compute_80\" (second (attr (iter \"assetData\" 76) \"value\" 79) 80) 80) (ifBlock (contains (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 83) ((defineLocal \"compute_85\" (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 85) 85) (defineLocal \"compute_86\" (first (getLocal \"compute_85\" 85) 86) 86) (defineLocal \"compute_87\" (first (getLocal \"compute_80\" 80) 87) 87) (ifBlock (gt (getLocal \"compute_87\" 87) (getLocal \"compute_86\" 86) 88) ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (getLocal \"compute_79\" 79) (pack (tuple (attr (iter \"assetData\" 76) \"key\" 78) (getLocal \"compute_80\" 80) 90) 90) 92) \"bad sig\" 91) (set (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 99) (getLocal \"compute_80\" 80) 99)) 88)) 83)) 76))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 392, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "AND an update", "line_no": 394}, {"action": "html", "tag": "h2", "inner": "WHEN the oracle is updated twice", "line_no": 416}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 418 ((literal (string \"XTZ-USD\") 425) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 409) (tuple (literal (timestamp 1) 395) (tuple (literal (timestamp 2) 396) (tuple (literal (intOrNat 3) 409) (tuple (literal (intOrNat 4) 409) (tuple (literal (intOrNat 5) 409) (tuple (literal (intOrNat 6) 409) (literal (intOrNat 7) 409) 409) 409) 409) 409) 409) 409) 409) 409) \"Raw\" 410) 410) (tuple (literal (timestamp 1) 395) (tuple (literal (timestamp 2) 396) (tuple (literal (intOrNat 3) 425) (tuple (literal (intOrNat 4) 425) (tuple (literal (intOrNat 5) 425) (tuple (literal (intOrNat 6) 425) (literal (intOrNat 7) 425) 425) 425) 425) 425) 425) 425) 417))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 418)", "line_no": 425, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "THEN the second update has no effect", "line_no": 427}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 418 ((literal (string \"XTZ-USD\") 428) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 409) (tuple (literal (timestamp 1) 395) (tuple (literal (timestamp 2) 396) (tuple (literal (intOrNat 3) 409) (tuple (literal (intOrNat 4) 409) (tuple (literal (intOrNat 5) 409) (tuple (literal (intOrNat 6) 409) (literal (intOrNat 7) 409) 409) 409) 409) 409) 409) 409) 409) 409) \"Raw\" 410) 410) (tuple (literal (timestamp 1) 395) (tuple (literal (timestamp 2) 396) (tuple (literal (intOrNat 3) 428) (tuple (literal (intOrNat 4) 428) (tuple (literal (intOrNat 5) 428) (tuple (literal (intOrNat 6) 428) (literal (intOrNat 7) 428) 428) 428) 428) 428) 428) 428) 417))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 418)", "line_no": 428, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "verify", "condition": "(eq (first (getItem (attr (contractData 0 428) \"oracleData\" 429) (literal (string \"XTZ-USD\") 429) 429) 436) (literal (timestamp 1) 395) 444)", "line_no": 444}, {"action": "verify", "condition": "(eq (first (second (getItem (attr (contractData 0 428) \"oracleData\" 429) (literal (string \"XTZ-USD\") 429) 429) 430) 437) (literal (timestamp 2) 396) 445)", "line_no": 445}, {"action": "verify", "condition": "(eq (first (second (second (getItem (attr (contractData 0 428) \"oracleData\" 429) (literal (string \"XTZ-USD\") 429) 429) 430) 431) 438) (literal (intOrNat 3) 446) 446)", "line_no": 446}, {"action": "verify", "condition": "(eq (first (second (second (second (getItem (attr (contractData 0 428) \"oracleData\" 429) (literal (string \"XTZ-USD\") 429) 429) 430) 431) 432) 439) (literal (intOrNat 4) 447) 447)", "line_no": 447}, {"action": "verify", "condition": "(eq (first (second (second (second (second (getItem (attr (contractData 0 428) \"oracleData\" 429) (literal (string \"XTZ-USD\") 429) 429) 430) 431) 432) 433) 440) (literal (intOrNat 5) 448) 448)", "line_no": 448}, {"action": "verify", "condition": "(eq (first (second (second (second (second (second (getItem (attr (contractData 0 428) \"oracleData\" 429) (literal (string \"XTZ-USD\") 429) 429) 430) 431) 432) 433) 434) 441) (literal (intOrNat 6) 449) 449)", "line_no": 449}, {"action": "verify", "condition": "(eq (second (second (second (second (second (second (getItem (attr (contractData 0 428) \"oracleData\" 429) (literal (string \"XTZ-USD\") 429) 429) 430) 431) 432) 433) 434) 442) (literal (intOrNat 7) 450) 450)", "line_no": 450}]}, {"shortname": "Update_Fails_With_Data_From_The_Past", "longname": "Update Fails With Data From The Past", "scenario": [{"action": "html", "tag": "h1", "inner": "Update Fails With Data From The Past", "line_no": 455}, {"action": "html", "tag": "h2", "inner": "GIVEN an Oracle contract with some initial data.", "line_no": 457}, {"action": "newContract", "id": 0, "export": "(storage (record 58 (oracleData (type_annotation (big_map 462 ((literal (string \"XTZ-USD\") 470) (tuple (literal (timestamp 0) 1088) (tuple (literal (timestamp 0) 1090) (tuple (literal (intOrNat 0) 470) (tuple (literal (intOrNat 0) 470) (tuple (literal (intOrNat 0) 470) (tuple (literal (intOrNat 0) 470) (literal (intOrNat 0) 470) 470) 470) 470) 470) 470) 470))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 462)) (publicKey (variant \"Some\" (reduce (attr (account_of_seed \"Test1\" 1082) \"public_key\" 1082) 1082) 1083)))\nstorage_type (())\nmessages ((push True ((set (operations 128) (cons (transfer (attr (data) \"oracleData\" 128) (literal (mutez 0) 128) (params 127) 128) (operations 128) 128) 128))) (revoke True ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (params 111) (pack (type_annotation (variant \"None\" (unit) -1) (option \"key\") 113) 114) 118) False 118) (set (attr (data) \"publicKey\" 117) (variant \"None\" (unit) -1) 121))) (update True ((forGroup \"assetData\" (items (params 73) 75) ((defineLocal \"compute_79\" (first (attr (iter \"assetData\" 76) \"value\" 79) 79) 79) (defineLocal \"compute_80\" (second (attr (iter \"assetData\" 76) \"value\" 79) 80) 80) (ifBlock (contains (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 83) ((defineLocal \"compute_85\" (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 85) 85) (defineLocal \"compute_86\" (first (getLocal \"compute_85\" 85) 86) 86) (defineLocal \"compute_87\" (first (getLocal \"compute_80\" 80) 87) 87) (ifBlock (gt (getLocal \"compute_87\" 87) (getLocal \"compute_86\" 86) 88) ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (getLocal \"compute_79\" 79) (pack (tuple (attr (iter \"assetData\" 76) \"key\" 78) (getLocal \"compute_80\" 80) 90) 90) 92) \"bad sig\" 91) (set (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 99) (getLocal \"compute_80\" 80) 99)) 88)) 83)) 76))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 470, "show": true, "accept_unknown_types": false}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 494 ((literal (string \"XTZ-USD\") 501) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 486) (tuple (literal (timestamp 3) 472) (tuple (literal (timestamp 4) 473) (tuple (literal (intOrNat 3) 486) (tuple (literal (intOrNat 4) 486) (tuple (literal (intOrNat 5) 486) (tuple (literal (intOrNat 6) 486) (literal (intOrNat 7) 486) 486) 486) 486) 486) 486) 486) 486) 486) \"Raw\" 487) 487) (tuple (literal (timestamp 3) 472) (tuple (literal (timestamp 4) 473) (tuple (literal (intOrNat 3) 501) (tuple (literal (intOrNat 4) 501) (tuple (literal (intOrNat 5) 501) (tuple (literal (intOrNat 6) 501) (literal (intOrNat 7) 501) 501) 501) 501) 501) 501) 501) 493))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 494)", "line_no": 501, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "WHEN the oracle is updated with a time in the past", "line_no": 503}, {"action": "html", "tag": "h2", "inner": "THEN the update in the past does not modify the data.", "line_no": 534}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 526 ((literal (string \"XTZ-USD\") 535) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (timestamp 1) 504) (tuple (literal (timestamp 2) 505) (tuple (literal (intOrNat 8) 518) (tuple (literal (intOrNat 9) 518) (tuple (literal (intOrNat 10) 518) (tuple (literal (intOrNat 11) 518) (literal (intOrNat 12) 518) 518) 518) 518) 518) 518) 518) 518) \"Raw\" 519) 519) (tuple (literal (timestamp 1) 504) (tuple (literal (timestamp 2) 505) (tuple (literal (intOrNat 8) 535) (tuple (literal (intOrNat 9) 535) (tuple (literal (intOrNat 10) 535) (tuple (literal (intOrNat 11) 535) (literal (intOrNat 12) 535) 535) 535) 535) 535) 535) 535) 525))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 526)", "line_no": 535, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "verify", "condition": "(eq (first (getItem (attr (contractData 0 535) \"oracleData\" 537) (literal (string \"XTZ-USD\") 537) 537) 544) (literal (timestamp 3) 472) 552)", "line_no": 552}, {"action": "verify", "condition": "(eq (first (second (getItem (attr (contractData 0 535) \"oracleData\" 537) (literal (string \"XTZ-USD\") 537) 537) 538) 545) (literal (timestamp 4) 473) 553)", "line_no": 553}, {"action": "verify", "condition": "(eq (first (second (second (getItem (attr (contractData 0 535) \"oracleData\" 537) (literal (string \"XTZ-USD\") 537) 537) 538) 539) 546) (literal (intOrNat 3) 554) 554)", "line_no": 554}, {"action": "verify", "condition": "(eq (first (second (second (second (getItem (attr (contractData 0 535) \"oracleData\" 537) (literal (string \"XTZ-USD\") 537) 537) 538) 539) 540) 547) (literal (intOrNat 4) 555) 555)", "line_no": 555}, {"action": "verify", "condition": "(eq (first (second (second (second (second (getItem (attr (contractData 0 535) \"oracleData\" 537) (literal (string \"XTZ-USD\") 537) 537) 538) 539) 540) 541) 548) (literal (intOrNat 5) 556) 556)", "line_no": 556}, {"action": "verify", "condition": "(eq (first (second (second (second (second (second (getItem (attr (contractData 0 535) \"oracleData\" 537) (literal (string \"XTZ-USD\") 537) 537) 538) 539) 540) 541) 542) 549) (literal (intOrNat 6) 557) 557)", "line_no": 557}, {"action": "verify", "condition": "(eq (second (second (second (second (second (second (getItem (attr (contractData 0 535) \"oracleData\" 537) (literal (string \"XTZ-USD\") 537) 537) 538) 539) 540) 541) 542) 550) (literal (intOrNat 7) 558) 558)", "line_no": 558}]}, {"shortname": "Untracked_Asset_does_not_update_oracle", "longname": "Untracked Asset does not update oracle", "scenario": [{"action": "html", "tag": "h1", "inner": "Update Fails With Untracked Asset", "line_no": 564}, {"action": "html", "tag": "h2", "inner": "GIVEN an Oracle contract tracking an asset", "line_no": 566}, {"action": "newContract", "id": 0, "export": "(storage (record 58 (oracleData (type_annotation (big_map 571 ((literal (string \"XTZ-USD\") 579) (tuple (literal (timestamp 0) 1088) (tuple (literal (timestamp 0) 1090) (tuple (literal (intOrNat 0) 579) (tuple (literal (intOrNat 0) 579) (tuple (literal (intOrNat 0) 579) (tuple (literal (intOrNat 0) 579) (literal (intOrNat 0) 579) 579) 579) 579) 579) 579) 579))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 571)) (publicKey (variant \"Some\" (reduce (attr (account_of_seed \"Test1\" 1082) \"public_key\" 1082) 1082) 1083)))\nstorage_type (())\nmessages ((push True ((set (operations 128) (cons (transfer (attr (data) \"oracleData\" 128) (literal (mutez 0) 128) (params 127) 128) (operations 128) 128) 128))) (revoke True ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (params 111) (pack (type_annotation (variant \"None\" (unit) -1) (option \"key\") 113) 114) 118) False 118) (set (attr (data) \"publicKey\" 117) (variant \"None\" (unit) -1) 121))) (update True ((forGroup \"assetData\" (items (params 73) 75) ((defineLocal \"compute_79\" (first (attr (iter \"assetData\" 76) \"value\" 79) 79) 79) (defineLocal \"compute_80\" (second (attr (iter \"assetData\" 76) \"value\" 79) 80) 80) (ifBlock (contains (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 83) ((defineLocal \"compute_85\" (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 85) 85) (defineLocal \"compute_86\" (first (getLocal \"compute_85\" 85) 86) 86) (defineLocal \"compute_87\" (first (getLocal \"compute_80\" 80) 87) 87) (ifBlock (gt (getLocal \"compute_87\" 87) (getLocal \"compute_86\" 86) 88) ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (getLocal \"compute_79\" 79) (pack (tuple (attr (iter \"assetData\" 76) \"key\" 78) (getLocal \"compute_80\" 80) 90) 90) 92) \"bad sig\" 91) (set (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 99) (getLocal \"compute_80\" 80) 99)) 88)) 83)) 76))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 579, "show": true, "accept_unknown_types": false}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 603 ((literal (string \"XTZ-USD\") 610) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 595) (tuple (literal (timestamp 2) 581) (tuple (literal (timestamp 3) 582) (tuple (literal (intOrNat 3) 595) (tuple (literal (intOrNat 4) 595) (tuple (literal (intOrNat 5) 595) (tuple (literal (intOrNat 6) 595) (literal (intOrNat 7) 595) 595) 595) 595) 595) 595) 595) 595) 595) \"Raw\" 596) 596) (tuple (literal (timestamp 2) 581) (tuple (literal (timestamp 3) 582) (tuple (literal (intOrNat 3) 610) (tuple (literal (intOrNat 4) 610) (tuple (literal (intOrNat 5) 610) (tuple (literal (intOrNat 6) 610) (literal (intOrNat 7) 610) 610) 610) 610) 610) 610) 610) 602))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 603)", "line_no": 610, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "WHEN the oracle is updated with an untracked asset", "line_no": 612}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 636 ((literal (string \"BTC-USD\") 643) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"BTC-USD\") 628) (tuple (literal (timestamp 4) 614) (tuple (literal (timestamp 5) 615) (tuple (literal (intOrNat 8) 628) (tuple (literal (intOrNat 9) 628) (tuple (literal (intOrNat 10) 628) (tuple (literal (intOrNat 11) 628) (literal (intOrNat 12) 628) 628) 628) 628) 628) 628) 628) 628) 628) \"Raw\" 629) 629) (tuple (literal (timestamp 4) 614) (tuple (literal (timestamp 5) 615) (tuple (literal (intOrNat 8) 643) (tuple (literal (intOrNat 9) 643) (tuple (literal (intOrNat 10) 643) (tuple (literal (intOrNat 11) 643) (literal (intOrNat 12) 643) 643) 643) 643) 643) 643) 643) 635))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 636)", "line_no": 643, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "THEN the oracle only contains the data for the tracked asset.", "line_no": 645}, {"action": "verify", "condition": "(eq (first (getItem (attr (contractData 0 643) \"oracleData\" 646) (literal (string \"XTZ-USD\") 646) 646) 653) (literal (timestamp 2) 581) 661)", "line_no": 661}, {"action": "verify", "condition": "(eq (first (second (getItem (attr (contractData 0 643) \"oracleData\" 646) (literal (string \"XTZ-USD\") 646) 646) 647) 654) (literal (timestamp 3) 582) 662)", "line_no": 662}, {"action": "verify", "condition": "(eq (first (second (second (getItem (attr (contractData 0 643) \"oracleData\" 646) (literal (string \"XTZ-USD\") 646) 646) 647) 648) 655) (literal (intOrNat 3) 663) 663)", "line_no": 663}, {"action": "verify", "condition": "(eq (first (second (second (second (getItem (attr (contractData 0 643) \"oracleData\" 646) (literal (string \"XTZ-USD\") 646) 646) 647) 648) 649) 656) (literal (intOrNat 4) 664) 664)", "line_no": 664}, {"action": "verify", "condition": "(eq (first (second (second (second (second (getItem (attr (contractData 0 643) \"oracleData\" 646) (literal (string \"XTZ-USD\") 646) 646) 647) 648) 649) 650) 657) (literal (intOrNat 5) 665) 665)", "line_no": 665}, {"action": "verify", "condition": "(eq (first (second (second (second (second (second (getItem (attr (contractData 0 643) \"oracleData\" 646) (literal (string \"XTZ-USD\") 646) 646) 647) 648) 649) 650) 651) 658) (literal (intOrNat 6) 666) 666)", "line_no": 666}, {"action": "verify", "condition": "(eq (second (second (second (second (second (second (getItem (attr (contractData 0 643) \"oracleData\" 646) (literal (string \"XTZ-USD\") 646) 646) 647) 648) 649) 650) 651) 659) (literal (intOrNat 7) 667) 667)", "line_no": 667}, {"action": "html", "tag": "h2", "inner": "AND does not contain data for the untracked asset", "line_no": 669}, {"action": "verify", "condition": "(invert (contains (attr (contractData 0 643) \"oracleData\" 646) (literal (string \"BTC-USD\") 670) 670) 670)", "line_no": 670}]}, {"shortname": "Update_Fails_With_Bad_Signature", "longname": "Update Fails With Bad Signature", "scenario": [{"action": "html", "tag": "h1", "inner": "Update Fails With Bad Signature", "line_no": 675}, {"action": "html", "tag": "h2", "inner": "GIVEN an Oracle contract", "line_no": 677}, {"action": "newContract", "id": 0, "export": "(storage (record 58 (oracleData (type_annotation (big_map 682 ((literal (string \"XTZ-USD\") 690) (tuple (literal (timestamp 0) 1088) (tuple (literal (timestamp 0) 1090) (tuple (literal (intOrNat 0) 690) (tuple (literal (intOrNat 0) 690) (tuple (literal (intOrNat 0) 690) (tuple (literal (intOrNat 0) 690) (literal (intOrNat 0) 690) 690) 690) 690) 690) 690) 690))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 682)) (publicKey (variant \"Some\" (reduce (attr (account_of_seed \"Test1\" 1082) \"public_key\" 1082) 1082) 1083)))\nstorage_type (())\nmessages ((push True ((set (operations 128) (cons (transfer (attr (data) \"oracleData\" 128) (literal (mutez 0) 128) (params 127) 128) (operations 128) 128) 128))) (revoke True ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (params 111) (pack (type_annotation (variant \"None\" (unit) -1) (option \"key\") 113) 114) 118) False 118) (set (attr (data) \"publicKey\" 117) (variant \"None\" (unit) -1) 121))) (update True ((forGroup \"assetData\" (items (params 73) 75) ((defineLocal \"compute_79\" (first (attr (iter \"assetData\" 76) \"value\" 79) 79) 79) (defineLocal \"compute_80\" (second (attr (iter \"assetData\" 76) \"value\" 79) 80) 80) (ifBlock (contains (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 83) ((defineLocal \"compute_85\" (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 85) 85) (defineLocal \"compute_86\" (first (getLocal \"compute_85\" 85) 86) 86) (defineLocal \"compute_87\" (first (getLocal \"compute_80\" 80) 87) 87) (ifBlock (gt (getLocal \"compute_87\" 87) (getLocal \"compute_86\" 86) 88) ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (getLocal \"compute_79\" 79) (pack (tuple (attr (iter \"assetData\" 76) \"key\" 78) (getLocal \"compute_80\" 80) 90) 90) 92) \"bad sig\" 91) (set (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 99) (getLocal \"compute_80\" 80) 99)) 88)) 83)) 76))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 690, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "AND an update signed by an alternative key", "line_no": 692}, {"action": "html", "tag": "h2", "inner": "WHEN the oracle is updated", "line_no": 716}, {"action": "html", "tag": "h2", "inner": "THEN the update fails", "line_no": 726}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 718 ((literal (string \"XTZ-USD\") 727) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"AlternativeAccount\" 693) \"secret_key\" 693) 693) (pack (tuple (literal (timestamp 1) 695) (tuple (literal (timestamp 2) 696) (tuple (literal (intOrNat 3) 709) (tuple (literal (intOrNat 4) 709) (tuple (literal (intOrNat 5) 709) (tuple (literal (intOrNat 6) 709) (literal (intOrNat 7) 709) 709) 709) 709) 709) 709) 709) 709) \"Raw\" 710) 710) (tuple (literal (timestamp 1) 695) (tuple (literal (timestamp 2) 696) (tuple (literal (intOrNat 3) 727) (tuple (literal (intOrNat 4) 727) (tuple (literal (intOrNat 5) 727) (tuple (literal (intOrNat 6) 727) (literal (intOrNat 7) 727) 727) 727) 727) 727) 727) 727) 717))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 718)", "line_no": 727, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": false}]}, {"shortname": "Revokes_An_Oracle", "longname": "Revokes An Oracle", "scenario": [{"action": "html", "tag": "h1", "inner": "Revokes An Oracle", "line_no": 733}, {"action": "html", "tag": "h2", "inner": "GIVEN an oracle contract and a correctly signed revoke message.", "line_no": 735}, {"action": "newContract", "id": 0, "export": "(storage (record 58 (oracleData (type_annotation (big_map 747 ((literal (string \"XTZ-USD\") 755) (tuple (literal (timestamp 0) 1088) (tuple (literal (timestamp 0) 1090) (tuple (literal (intOrNat 0) 755) (tuple (literal (intOrNat 0) 755) (tuple (literal (intOrNat 0) 755) (tuple (literal (intOrNat 0) 755) (literal (intOrNat 0) 755) 755) 755) 755) 755) 755) 755))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 747)) (publicKey (variant \"Some\" (reduce (attr (account_of_seed \"Test1\" 1082) \"public_key\" 1082) 1082) 1083)))\nstorage_type (())\nmessages ((push True ((set (operations 128) (cons (transfer (attr (data) \"oracleData\" 128) (literal (mutez 0) 128) (params 127) 128) (operations 128) 128) 128))) (revoke True ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (params 111) (pack (type_annotation (variant \"None\" (unit) -1) (option \"key\") 113) 114) 118) False 118) (set (attr (data) \"publicKey\" 117) (variant \"None\" (unit) -1) 121))) (update True ((forGroup \"assetData\" (items (params 73) 75) ((defineLocal \"compute_79\" (first (attr (iter \"assetData\" 76) \"value\" 79) 79) 79) (defineLocal \"compute_80\" (second (attr (iter \"assetData\" 76) \"value\" 79) 80) 80) (ifBlock (contains (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 83) ((defineLocal \"compute_85\" (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 85) 85) (defineLocal \"compute_86\" (first (getLocal \"compute_85\" 85) 86) 86) (defineLocal \"compute_87\" (first (getLocal \"compute_80\" 80) 87) 87) (ifBlock (gt (getLocal \"compute_87\" 87) (getLocal \"compute_86\" 86) 88) ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (getLocal \"compute_79\" 79) (pack (tuple (attr (iter \"assetData\" 76) \"key\" 78) (getLocal \"compute_80\" 80) 90) 90) 92) \"bad sig\" 91) (set (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 99) (getLocal \"compute_80\" 80) 99)) 88)) 83)) 76))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 755, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "WHEN revoke is called.", "line_no": 757}, {"action": "message", "id": 0, "message": "revoke", "params": "(reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (variant \"None\" (unit) -1) 737) \"Raw\" 738) 738)", "line_no": 758, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "THEN the oracle is revoked", "line_no": 760}, {"action": "verify", "condition": "(invert (isVariant (attr (contractData 0 758) \"publicKey\" 761) \"Some\" 761) 761)", "line_no": 761}, {"action": "html", "tag": "h2", "inner": "AND future updates fail.", "line_no": 763}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 786 ((literal (string \"XTZ-USD\") 793) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 778) (tuple (literal (timestamp 1) 764) (tuple (literal (timestamp 2) 765) (tuple (literal (intOrNat 3) 778) (tuple (literal (intOrNat 4) 778) (tuple (literal (intOrNat 5) 778) (tuple (literal (intOrNat 6) 778) (literal (intOrNat 7) 778) 778) 778) 778) 778) 778) 778) 778) 778) \"Raw\" 779) 779) (tuple (literal (timestamp 1) 764) (tuple (literal (timestamp 2) 765) (tuple (literal (intOrNat 3) 793) (tuple (literal (intOrNat 4) 793) (tuple (literal (intOrNat 5) 793) (tuple (literal (intOrNat 6) 793) (literal (intOrNat 7) 793) 793) 793) 793) 793) 793) 793) 785))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 786)", "line_no": 793, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": false}]}, {"shortname": "Incorrect_Revoke_Fails_to_Revoke_An_Oracle", "longname": "Incorrect Revoke Fails to Revoke An Oracle", "scenario": [{"action": "html", "tag": "h1", "inner": "Incorrect Revoke Fails to Revoke An Oracle", "line_no": 799}, {"action": "html", "tag": "h2", "inner": "GIVEN an oracle contract and a revoke message signed by another account.", "line_no": 801}, {"action": "newContract", "id": 0, "export": "(storage (record 58 (oracleData (type_annotation (big_map 814 ((literal (string \"XTZ-USD\") 822) (tuple (literal (timestamp 0) 1088) (tuple (literal (timestamp 0) 1090) (tuple (literal (intOrNat 0) 822) (tuple (literal (intOrNat 0) 822) (tuple (literal (intOrNat 0) 822) (tuple (literal (intOrNat 0) 822) (literal (intOrNat 0) 822) 822) 822) 822) 822) 822) 822))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 814)) (publicKey (variant \"Some\" (reduce (attr (account_of_seed \"Test1\" 1082) \"public_key\" 1082) 1082) 1083)))\nstorage_type (())\nmessages ((push True ((set (operations 128) (cons (transfer (attr (data) \"oracleData\" 128) (literal (mutez 0) 128) (params 127) 128) (operations 128) 128) 128))) (revoke True ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (params 111) (pack (type_annotation (variant \"None\" (unit) -1) (option \"key\") 113) 114) 118) False 118) (set (attr (data) \"publicKey\" 117) (variant \"None\" (unit) -1) 121))) (update True ((forGroup \"assetData\" (items (params 73) 75) ((defineLocal \"compute_79\" (first (attr (iter \"assetData\" 76) \"value\" 79) 79) 79) (defineLocal \"compute_80\" (second (attr (iter \"assetData\" 76) \"value\" 79) 80) 80) (ifBlock (contains (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 83) ((defineLocal \"compute_85\" (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 85) 85) (defineLocal \"compute_86\" (first (getLocal \"compute_85\" 85) 86) 86) (defineLocal \"compute_87\" (first (getLocal \"compute_80\" 80) 87) 87) (ifBlock (gt (getLocal \"compute_87\" 87) (getLocal \"compute_86\" 86) 88) ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (getLocal \"compute_79\" 79) (pack (tuple (attr (iter \"assetData\" 76) \"key\" 78) (getLocal \"compute_80\" 80) 90) 90) 92) \"bad sig\" 91) (set (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 99) (getLocal \"compute_80\" 80) 99)) 88)) 83)) 76))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 822, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "WHEN revoke is called", "line_no": 824}, {"action": "html", "tag": "h2", "inner": "THEN the call fails", "line_no": 825}, {"action": "message", "id": 0, "message": "revoke", "params": "(reduce (make_signature (reduce (attr (account_of_seed \"Incorrect_Account\" 803) \"secret_key\" 803) 803) (pack (variant \"None\" (unit) -1) 804) \"Raw\" 805) 805)", "line_no": 826, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": false}, {"action": "html", "tag": "h2", "inner": "AND future updates succeed", "line_no": 828}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 851 ((literal (string \"XTZ-USD\") 858) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 843) (tuple (literal (timestamp 1) 829) (tuple (literal (timestamp 2) 830) (tuple (literal (intOrNat 3) 843) (tuple (literal (intOrNat 4) 843) (tuple (literal (intOrNat 5) 843) (tuple (literal (intOrNat 6) 843) (literal (intOrNat 7) 843) 843) 843) 843) 843) 843) 843) 843) 843) \"Raw\" 844) 844) (tuple (literal (timestamp 1) 829) (tuple (literal (timestamp 2) 830) (tuple (literal (intOrNat 3) 858) (tuple (literal (intOrNat 4) 858) (tuple (literal (intOrNat 5) 858) (tuple (literal (intOrNat 6) 858) (literal (intOrNat 7) 858) 858) 858) 858) 858) 858) 858) 850))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 851)", "line_no": 858, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}]}, {"shortname": "Update_with_stale_asset_does_not_fail", "longname": "Update with stale asset does not fail", "scenario": [{"action": "html", "tag": "h1", "inner": "Update with stale asset does not fail", "line_no": 863}, {"action": "html", "tag": "h2", "inner": "GIVEN an Oracle contract tracking two assets with an initial update", "line_no": 865}, {"action": "newContract", "id": 0, "export": "(storage (record 58 (oracleData (type_annotation (big_map 871 ((literal (string \"XTZ-USD\") 880) (tuple (literal (timestamp 0) 1088) (tuple (literal (timestamp 0) 1090) (tuple (literal (intOrNat 0) 880) (tuple (literal (intOrNat 0) 880) (tuple (literal (intOrNat 0) 880) (tuple (literal (intOrNat 0) 880) (literal (intOrNat 0) 880) 880) 880) 880) 880) 880) 880)) ((literal (string \"BTC-USD\") 880) (tuple (literal (timestamp 0) 1088) (tuple (literal (timestamp 0) 1090) (tuple (literal (intOrNat 0) 880) (tuple (literal (intOrNat 0) 880) (tuple (literal (intOrNat 0) 880) (tuple (literal (intOrNat 0) 880) (literal (intOrNat 0) 880) 880) 880) 880) 880) 880) 880))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 871)) (publicKey (variant \"Some\" (reduce (attr (account_of_seed \"Test1\" 1082) \"public_key\" 1082) 1082) 1083)))\nstorage_type (())\nmessages ((push True ((set (operations 128) (cons (transfer (attr (data) \"oracleData\" 128) (literal (mutez 0) 128) (params 127) 128) (operations 128) 128) 128))) (revoke True ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (params 111) (pack (type_annotation (variant \"None\" (unit) -1) (option \"key\") 113) 114) 118) False 118) (set (attr (data) \"publicKey\" 117) (variant \"None\" (unit) -1) 121))) (update True ((forGroup \"assetData\" (items (params 73) 75) ((defineLocal \"compute_79\" (first (attr (iter \"assetData\" 76) \"value\" 79) 79) 79) (defineLocal \"compute_80\" (second (attr (iter \"assetData\" 76) \"value\" 79) 80) 80) (ifBlock (contains (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 83) ((defineLocal \"compute_85\" (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 85) 85) (defineLocal \"compute_86\" (first (getLocal \"compute_85\" 85) 86) 86) (defineLocal \"compute_87\" (first (getLocal \"compute_80\" 80) 87) 87) (ifBlock (gt (getLocal \"compute_87\" 87) (getLocal \"compute_86\" 86) 88) ((verify (check_signature (openVariant (attr (data) \"publicKey\" 117) \"Some\" 117) (getLocal \"compute_79\" 79) (pack (tuple (attr (iter \"assetData\" 76) \"key\" 78) (getLocal \"compute_80\" 80) 90) 90) 92) \"bad sig\" 91) (set (getItem (attr (data) \"oracleData\" 128) (attr (iter \"assetData\" 76) \"key\" 78) 99) (getLocal \"compute_80\" 80) 99)) 88)) 83)) 76))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 880, "show": true, "accept_unknown_types": false}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 915 ((literal (string \"XTZ-USD\") 923) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 898) (tuple (literal (timestamp 1) 882) (tuple (literal (timestamp 2) 883) (tuple (literal (intOrNat 3) 898) (tuple (literal (intOrNat 4) 898) (tuple (literal (intOrNat 5) 898) (tuple (literal (intOrNat 6) 898) (literal (intOrNat 7) 898) 898) 898) 898) 898) 898) 898) 898) 898) \"Raw\" 899) 899) (tuple (literal (timestamp 1) 882) (tuple (literal (timestamp 2) 883) (tuple (literal (intOrNat 3) 923) (tuple (literal (intOrNat 4) 923) (tuple (literal (intOrNat 5) 923) (tuple (literal (intOrNat 6) 923) (literal (intOrNat 7) 923) 923) 923) 923) 923) 923) 923) 912)) ((literal (string \"BTC-USD\") 923) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"BTC-USD\") 905) (tuple (literal (timestamp 1) 882) (tuple (literal (timestamp 2) 883) (tuple (literal (intOrNat 3) 905) (tuple (literal (intOrNat 4) 905) (tuple (literal (intOrNat 5) 905) (tuple (literal (intOrNat 6) 905) (literal (intOrNat 7) 905) 905) 905) 905) 905) 905) 905) 905) 905) \"Raw\" 906) 906) (tuple (literal (timestamp 1) 882) (tuple (literal (timestamp 2) 883) (tuple (literal (intOrNat 3) 923) (tuple (literal (intOrNat 4) 923) (tuple (literal (intOrNat 5) 923) (tuple (literal (intOrNat 6) 923) (literal (intOrNat 7) 923) 923) 923) 923) 923) 923) 923) 913))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 915)", "line_no": 923, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "WHEN an update is posted to the oracle with only one asset containing new data", "line_no": 925}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (map 951 ((literal (string \"XTZ-USD\") 959) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"XTZ-USD\") 942) (tuple (literal (timestamp 2) 926) (tuple (literal (timestamp 3) 927) (tuple (literal (intOrNat 8) 942) (tuple (literal (intOrNat 9) 942) (tuple (literal (intOrNat 10) 942) (tuple (literal (intOrNat 11) 942) (literal (intOrNat 12) 942) 942) 942) 942) 942) 942) 942) 942) 942) \"Raw\" 943) 943) (tuple (literal (timestamp 2) 926) (tuple (literal (timestamp 3) 927) (tuple (literal (intOrNat 8) 959) (tuple (literal (intOrNat 9) 959) (tuple (literal (intOrNat 10) 959) (tuple (literal (intOrNat 11) 959) (literal (intOrNat 12) 959) 959) 959) 959) 959) 959) 959) 949)) ((literal (string \"BTC-USD\") 959) (tuple (reduce (make_signature (reduce (attr (account_of_seed \"Test1\" 1082) \"secret_key\" 1082) 1082) (pack (tuple (literal (string \"BTC-USD\") 905) (tuple (literal (timestamp 1) 882) (tuple (literal (timestamp 2) 883) (tuple (literal (intOrNat 3) 905) (tuple (literal (intOrNat 4) 905) (tuple (literal (intOrNat 5) 905) (tuple (literal (intOrNat 6) 905) (literal (intOrNat 7) 905) 905) 905) 905) 905) 905) 905) 905) 905) \"Raw\" 906) 906) (tuple (literal (timestamp 1) 882) (tuple (literal (timestamp 2) 883) (tuple (literal (intOrNat 3) 959) (tuple (literal (intOrNat 4) 959) (tuple (literal (intOrNat 5) 959) (tuple (literal (intOrNat 6) 959) (literal (intOrNat 7) 959) 959) 959) 959) 959) 959) 959) 913))) (map \"string\" (pair \"signature\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\")))))))) 951)", "line_no": 959, "title": "", "messageClass": "", "source": "none", "sender": "none", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": true}, {"action": "html", "tag": "h2", "inner": "THEN data for the asset with two updates is the second update.", "line_no": 961}, {"action": "verify", "condition": "(eq (first (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"XTZ-USD\") 962) 962) 969) (literal (timestamp 2) 926) 977)", "line_no": 977}, {"action": "verify", "condition": "(eq (first (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"XTZ-USD\") 962) 962) 963) 970) (literal (timestamp 3) 927) 978)", "line_no": 978}, {"action": "verify", "condition": "(eq (first (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"XTZ-USD\") 962) 962) 963) 964) 971) (literal (intOrNat 8) 979) 979)", "line_no": 979}, {"action": "verify", "condition": "(eq (first (second (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"XTZ-USD\") 962) 962) 963) 964) 965) 972) (literal (intOrNat 9) 980) 980)", "line_no": 980}, {"action": "verify", "condition": "(eq (first (second (second (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"XTZ-USD\") 962) 962) 963) 964) 965) 966) 973) (literal (intOrNat 10) 981) 981)", "line_no": 981}, {"action": "verify", "condition": "(eq (first (second (second (second (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"XTZ-USD\") 962) 962) 963) 964) 965) 966) 967) 974) (literal (intOrNat 11) 982) 982)", "line_no": 982}, {"action": "verify", "condition": "(eq (second (second (second (second (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"XTZ-USD\") 962) 962) 963) 964) 965) 966) 967) 975) (literal (intOrNat 12) 983) 983)", "line_no": 983}, {"action": "html", "tag": "h2", "inner": "THEN data for the asset with two updates is the second update.", "line_no": 985}, {"action": "verify", "condition": "(eq (first (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"BTC-USD\") 986) 986) 993) (literal (timestamp 1) 882) 1001)", "line_no": 1001}, {"action": "verify", "condition": "(eq (first (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"BTC-USD\") 986) 986) 987) 994) (literal (timestamp 2) 883) 1002)", "line_no": 1002}, {"action": "verify", "condition": "(eq (first (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"BTC-USD\") 986) 986) 987) 988) 995) (literal (intOrNat 3) 1003) 1003)", "line_no": 1003}, {"action": "verify", "condition": "(eq (first (second (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"BTC-USD\") 986) 986) 987) 988) 989) 996) (literal (intOrNat 4) 1004) 1004)", "line_no": 1004}, {"action": "verify", "condition": "(eq (first (second (second (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"BTC-USD\") 986) 986) 987) 988) 989) 990) 997) (literal (intOrNat 5) 1005) 1005)", "line_no": 1005}, {"action": "verify", "condition": "(eq (first (second (second (second (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"BTC-USD\") 986) 986) 987) 988) 989) 990) 991) 998) (literal (intOrNat 6) 1006) 1006)", "line_no": 1006}, {"action": "verify", "condition": "(eq (second (second (second (second (second (second (getItem (attr (contractData 0 959) \"oracleData\" 962) (literal (string \"BTC-USD\") 986) 986) 987) 988) 989) 990) 991) 999) (literal (intOrNat 7) 1007) 1007)", "line_no": 1007}]}]