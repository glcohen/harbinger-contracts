Comment...
 h1: Unrelated Assets do not affect normalizer
Comment...
 h2: GIVEN a Normalizer contract
Creating contract
 -> (Pair (Pair {"XTZ-USD"; "BTC-USD"} {Elt "BTC-USD" (Pair (Pair 0 "0") (Pair (Pair (Pair 0 -1) (Pair {Elt 0 0} 0)) (Pair (Pair 0 -1) (Pair {Elt 0 0} 0)))); Elt "XTZ-USD" (Pair (Pair 0 "0") (Pair (Pair (Pair 0 -1) (Pair {Elt 0 0} 0)) (Pair (Pair 0 -1) (Pair {Elt 0 0} 0))))}) (Pair 3 "KT1QLPABNCD4z1cSYVv3ntYDYgtWTed7LkYr"))
 => ./.smartpy_out/Unrelated_Assets_do_not_affect_normalizer_interpreted/testContractTypes.0.2.tz 2
 => ./.smartpy_out/Unrelated_Assets_do_not_affect_normalizer_interpreted/testContractCode.0.2.tz 1224
 => ./.smartpy_out/Unrelated_Assets_do_not_affect_normalizer_interpreted/testContractCode.0.2.tz.json 1176
 => ./.smartpy_out/Unrelated_Assets_do_not_affect_normalizer_interpreted/testPrettyPrint.0.2.py 47
Comment...
 h2: WHEN two updates are provided for the asset
Executing update(sp.set_type_expr({'XTZ-USD' : (sp.timestamp(1595104530), (sp.timestamp(1595104531), (3059701, (1, (2, (3, 4))))))}, sp.TBigMap(sp.TString, sp.TPair(sp.TTimestamp, sp.TPair(sp.TTimestamp, sp.TPair(sp.TNat, sp.TPair(sp.TNat, sp.TPair(sp.TNat, sp.TPair(sp.TNat, sp.TNat)))))))))...
 -> (Pair (Pair {"XTZ-USD"; "BTC-USD"} {Elt "BTC-USD" (Pair (Pair 0 "0") (Pair (Pair (Pair 0 -1) (Pair {Elt 0 0} 0)) (Pair (Pair 0 -1) (Pair {Elt 0 0} 0)))); Elt "XTZ-USD" (Pair (Pair 2 "1595104530") (Pair (Pair (Pair 0 0) (Pair {Elt 0 8} 8)) (Pair (Pair 0 0) (Pair {Elt 0 4} 4))))}) (Pair 3 "KT1QLPABNCD4z1cSYVv3ntYDYgtWTed7LkYr"))
Executing update(sp.set_type_expr({'XTZ-USD' : (sp.timestamp(1595104532), (sp.timestamp(1595104533), (3059701, (5, (6, (7, 8))))))}, sp.TBigMap(sp.TString, sp.TPair(sp.TTimestamp, sp.TPair(sp.TTimestamp, sp.TPair(sp.TNat, sp.TPair(sp.TNat, sp.TPair(sp.TNat, sp.TPair(sp.TNat, sp.TNat)))))))))...
 -> (Pair (Pair {"XTZ-USD"; "BTC-USD"} {Elt "BTC-USD" (Pair (Pair 0 "0") (Pair (Pair (Pair 0 -1) (Pair {Elt 0 0} 0)) (Pair (Pair 0 -1) (Pair {Elt 0 0} 0)))); Elt "XTZ-USD" (Pair (Pair 4 "1595104532") (Pair (Pair (Pair 0 1) (Pair {Elt 0 8; Elt 1 48} 56)) (Pair (Pair 0 1) (Pair {Elt 0 4; Elt 1 8} 12))))}) (Pair 3 "KT1QLPABNCD4z1cSYVv3ntYDYgtWTed7LkYr"))
Executing update(sp.set_type_expr({'BTC-USD' : (sp.timestamp(1595104534), (sp.timestamp(1595104535), (3059701, (9, (10, (11, 12))))))}, sp.TBigMap(sp.TString, sp.TPair(sp.TTimestamp, sp.TPair(sp.TTimestamp, sp.TPair(sp.TNat, sp.TPair(sp.TNat, sp.TPair(sp.TNat, sp.TPair(sp.TNat, sp.TNat)))))))))...
 -> (Pair (Pair {"XTZ-USD"; "BTC-USD"} {Elt "BTC-USD" (Pair (Pair 10 "1595104534") (Pair (Pair (Pair 0 0) (Pair {Elt 0 120} 120)) (Pair (Pair 0 0) (Pair {Elt 0 12} 12)))); Elt "XTZ-USD" (Pair (Pair 4 "1595104532") (Pair (Pair (Pair 0 1) (Pair {Elt 0 8; Elt 1 48} 56)) (Pair (Pair 0 1) (Pair {Elt 0 4; Elt 1 8} 12))))}) (Pair 3 "KT1QLPABNCD4z1cSYVv3ntYDYgtWTed7LkYr"))
Comment...
 h2: THEN the contract is only tracking two updates for the tracked asset
Verifying ((sp.contract_data(0).assetMap['XTZ-USD'].prices.last - sp.contract_data(0).assetMap['XTZ-USD'].prices.first) + 1) == 2...
 => ./.smartpy_out/Unrelated_Assets_do_not_affect_normalizer_interpreted/testVerify.8.tz 53
 OK
Verifying ((sp.contract_data(0).assetMap['XTZ-USD'].volumes.last - sp.contract_data(0).assetMap['XTZ-USD'].volumes.first) + 1) == 2...
 => ./.smartpy_out/Unrelated_Assets_do_not_affect_normalizer_interpreted/testVerify.9.tz 53
 OK
Comment...
 h2: AND the computed price is the VWAP of the two updates
Verifying sp.contract_data(0).assetMap['XTZ-USD'].computedPrice == 4...
 => ./.smartpy_out/Unrelated_Assets_do_not_affect_normalizer_interpreted/testVerify.11.tz 35
 OK