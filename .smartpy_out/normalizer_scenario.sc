[{"shortname": "Fails_with_bad_contract_data", "longname": "Fails with bad contract data", "scenario": [{"action": "html", "tag": "h1", "inner": "Fails when data is pushed from bad address", "line_no": 143}, {"action": "html", "tag": "h2", "inner": "GIVEN a Normalizer contract whitelisted to an address", "line_no": 145}, {"action": "newContract", "id": 0, "export": "(storage (record 61 (assetCode (literal (string \"XTZ-USD\") 61)) (assetMap (big_map 55 ((literal (string \"XTZ-USD\") 147) (record 47 (computedPrice (literal (intOrNat 0) 47)) (lastUpdateTime (literal (timestamp 0) 50)) (pricesQueue (record 48 (first (literal (intOrNat 0) 48)) (last (literal (int -1) 48)) (saved (map 48 ((literal (intOrNat 0) 147) (literal (nat 0) 48)))) (sum (literal (nat 0) 48)))) (volumesQueue (record 49 (first (literal (intOrNat 0) 49)) (last (literal (int -1) 49)) (saved (map 49 ((literal (intOrNat 0) 147) (literal (nat 0) 49)))) (sum (literal (nat 0) 49)))))))) (numDataPoints (literal (int 3) 42)) (oracleContract (tuple (literal (address \"KT1QLPABNCD4z1cSYVv3ntYDYgtWTed7LkYr\") 41) 61)))\nstorage_type (())\nmessages ((get True ((set (operations 134) (cons (transfer (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 134) \"computedPrice\" 134) (literal (mutez 0) 134) (params 133) 134) (operations 134) 134) 134))) (update True ((set_type (params 78) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 79) (verify (eq (sender) (attr (data) \"oracleContract\" 83) 83) False (literal (string \"bad sender\") 82) 82) (defineLocal \"compute_88\" (getItem (params 78) (attr (data) \"assetCode\" 134) 88) 88) (defineLocal \"compute_91\" (first (getLocal \"compute_88\" 88) 91) 91) (verify (gt (getLocal \"compute_91\" 91) (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 92) \"lastUpdateTime\" 92) 92) False 92) (set (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 95) \"lastUpdateTime\" 95) (getLocal \"compute_91\" 91) 95) (defineLocal \"compute_98\" (second (getLocal \"compute_88\" 88) 98) 98) (defineLocal \"compute_99\" (second (getLocal \"compute_98\" 98) 99) 99) (defineLocal \"compute_100\" (second (getLocal \"compute_99\" 99) 100) 100) (defineLocal \"compute_101\" (second (getLocal \"compute_100\" 100) 101) 101) (defineLocal \"compute_102\" (second (getLocal \"compute_101\" 101) 102) 102) (defineLocal \"compute_106\" (first (getLocal \"compute_100\" 100) 106) 106) (defineLocal \"compute_107\" (first (getLocal \"compute_101\" 101) 107) 107) (defineLocal \"compute_108\" (first (getLocal \"compute_102\" 102) 108) 108) (defineLocal \"compute_109\" (second (getLocal \"compute_102\" 102) 109) 109) (set (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 113) \"prices\" 113) \"last\" 113) (add (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 113) \"prices\" 113) \"last\" 113) (literal (intOrNat 1) 113) 113) 113) (set (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 113) \"prices\" 113) \"sum\" 113) (add (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 113) \"prices\" 113) \"sum\" 113) (mul (truediv (add (add (getLocal \"compute_106\" 106) (getLocal \"compute_107\" 107) 110) (getLocal \"compute_108\" 108) 110) (literal (intOrNat 3) 110) 110) (getLocal \"compute_109\" 109) 110) 113) 113) (set (getItem (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 113) \"prices\" 113) \"saved\" 113) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 113) \"prices\" 113) \"last\" 113) 113) (mul (truediv (add (add (getLocal \"compute_106\" 106) (getLocal \"compute_107\" 107) 110) (getLocal \"compute_108\" 108) 110) (literal (intOrNat 3) 110) 110) (getLocal \"compute_109\" 109) 110) 113) (set (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 114) \"volumes\" 114) \"last\" 114) (add (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 114) \"volumes\" 114) \"last\" 114) (literal (intOrNat 1) 114) 114) 114) (set (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 114) \"volumes\" 114) \"sum\" 114) (add (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 114) \"volumes\" 114) \"sum\" 114) (getLocal \"compute_109\" 109) 114) 114) (set (getItem (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 114) \"volumes\" 114) \"saved\" 114) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 114) \"volumes\" 114) \"last\" 114) 114) (getLocal \"compute_109\" 109) 114) (ifBlock (gt (add (sub (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 117) \"prices\" 117) \"last\" 117) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 117) \"prices\" 117) \"first\" 117) 117) (literal (intOrNat 1) 117) 117) (attr (data) \"numDataPoints\" 117) 117) ((verify (lt (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"first\" 118) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"last\" 118) 118) False 118) (set (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"sum\" 118) (openVariant (isNat (sub (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"sum\" 118) (getItem (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"saved\" 118) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"first\" 118) 118) 118) 118) \"Some\" 118) 118) (delItem (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"saved\" 118) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"first\" 118) 118) (set (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"first\" 118) (add (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 118) \"prices\" 118) \"first\" 118) (literal (intOrNat 1) 118) 118) 118) (verify (lt (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"first\" 119) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"last\" 119) 119) False 119) (set (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"sum\" 119) (openVariant (isNat (sub (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"sum\" 119) (getItem (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"saved\" 119) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"first\" 119) 119) 119) 119) \"Some\" 119) 119) (delItem (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"saved\" 119) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"first\" 119) 119) (set (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"first\" 119) (add (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 119) \"volumes\" 119) \"first\" 119) (literal (intOrNat 1) 119) 119) 119)) 117) (set (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 122) \"computedPrice\" 122) (truediv (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 122) \"prices\" 122) \"sum\" 122) (attr (attr (getItem (attr (data) \"assetMap\" 134) (attr (data) \"assetCode\" 134) 122) \"volumes\" 122) \"sum\" 122) 122) 122))))\nflags (Exception_Unit no_comment)\nglobals ()\nstorage_layout ()\nentry_points_layout ())", "line_no": 147, "show": true, "accept_unknown_types": false}, {"action": "html", "tag": "h2", "inner": "WHEN an update is pushed from the wrong address", "line_no": 149}, {"action": "html", "tag": "h2", "inner": "THEN the update fails.", "line_no": 150}, {"action": "message", "id": 0, "message": "update", "params": "(type_annotation (big_map 486 ((literal (string \"XTZ-USD\") 152) (tuple (literal (timestamp 1595104501) 155) (tuple (literal (timestamp 1595104531) 156) (tuple (literal (intOrNat 3059701) 152) (tuple (literal (intOrNat 1) 152) (tuple (literal (intOrNat 2) 152) (tuple (literal (intOrNat 3) 152) (literal (intOrNat 4) 152) 152) 152) 152) 152) 152) 152))) (bigmap \"string\" (pair \"timestamp\" (pair \"timestamp\" (pair \"nat\" (pair \"nat\" (pair \"nat\" (pair \"nat\" \"nat\"))))))) 486)", "line_no": 152, "title": "", "messageClass": "", "source": "none", "sender": "address:(literal (address \"KT1FrRkunqmB7futF3EyRwTt8f7fPEVJW39P\") 151)", "chain_id": "", "time": 0, "amount": "(literal (mutez 0) 1)", "show": true, "valid": false}]}]